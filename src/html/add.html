<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Bang</title>
    <link rel="stylesheet" href="./src/css/global.css" />
    <link rel="stylesheet" href="./src/css/form.css" />
</head>

<body style="background-color: transparent">
    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;" id="add">
        <div class="content-container" id="custom-bang">
            <h1>Add Custom Bang</h1>

            <div id="explain"></div>

            <p class="custom-paragraph">The {{{s}}} in the URL is a placeholder that will be replaced dynamically with
                the user's
                search term
                when the bang is
                used. For example, if the user searches for "example" using the bang, the URL
                https://duckduckgo.com/bangs?q={{{s}}}
                will become https://duckduckgo.com/bangs?q=example.</p>

            <button id="toggle" onclick="toggle_explanation()">Show full explanation</button>

            <form style="margin-top: 5%;" id="custom-bang-form" onsubmit="validateForm(event)" novalidate>
                <div class="error-message" id="bang-error" hidden="true"></div>
                <input class="input-required" type="text" id="bang" placeholder="Bang Tag" required />

                <div class="error-message" id="bang-domain-error" hidden="true"></div>
                <input class="input-required" type="text" id="bang-domain"
                    placeholder="Bang Domain (e.g: duckduckgo.com)" required />

                <div class="error-message" id="bang-url-error" hidden="true"></div>
                <input class="input-required" type="url" id="bang-url"
                    placeholder="URL (e.g: https://duckduckgo.com/bangs?q={{{s}}})" required />

                <input class="input-optional" type="text" id="bang-category"
                    placeholder="Optional: Bang Category (e.g: General)" />

                <input class="input-optional" type="text" id="bang-description"
                    placeholder="Optional: Description (e.g: Search the bang shortcuts)" />

                <input class="input-optional" type="text" id="bang-sc" placeholder="Optional: KeyWord (e.g: ChatGPT)" />

                <button class="button-form" type="submit">Add Bang</button>
            </form>
        </div>
    </div>
    <script>
        function validateForm(event) {
            event.preventDefault(); // Prevent form submission

            // Get the form element
            const form = document.getElementById('custom-bang-form');

            // Clear previous custom error messages
            document.querySelectorAll('.error-message').forEach(el => {
                el.innerHTML = '';
                el.setAttribute('hidden', 'true');
            });
            const fields = form.querySelectorAll('input');
            fields.forEach(field => {
                field.classList.remove('input-error');
            })

            let isValid = true;
            let firstInvalidField = null;

            // Use browser validation for each input field
            fields.forEach(field => {
                if (!field.checkValidity()) {
                    const errorElement = document.getElementById(`${field.id}-error`);
                    if (errorElement) {
                        errorElement.innerText = field.validationMessage; // Use browser's validation message
                        errorElement.removeAttribute('hidden');
                    }
                    field.classList.add('input-error');
                    isValid = false;
                    if (!firstInvalidField) firstInvalidField = field;
                }
            });

            // Focus the first invalid field
            if (firstInvalidField) {
                firstInvalidField.focus();
            }

            // If the form is valid, submit it
            if (isValid) {
                document.getElementById('custom-bang-form').submit();
            }

            // Helper function to validate URL format
            function isValidURL(url) {
                const pattern = new RegExp('^(https?:\\/\\/)?' + // Protocol
                    '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // Domain name
                    '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR IP (v4) address
                    '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // Port and path
                    '(\\?[;&a-z\\d%_.~+=-]*)?' + // Query string
                    '(\\#[-a-z\\d_]*)?$', 'i'); // Fragment locator
                return !!pattern.test(url);
            }
        }
    </script>
    <script>
        const explain = `<p class="custom-paragraph">The form in the add.html file is designed to collect details for adding a
                "Custom Bang,"
                which is
                essentially a shortcut
                for a search query. Here's what each field expects:</p>

            <p class="custom-paragraph"><strong>Bang Tag</strong> Name (id="bang (e.g: bang)"): The name of the custom
                bang (e.g., "bang").
            </p>

            <p class="custom-paragraph"><strong>Bang Domain</strong> (id="bang-domain"): The domain of the search engine
                or website
                (e.g.,
                "duckduckgo.com").</p>

            <p class="custom-paragraph"><strong>URL</strong> (id="bang-domain"): The URL template for the search query.
                The placeholder
                {{{s}}}
                should be used to
                indicate where
                the search keyword will be inserted (e.g., https://duckduckgo.com/bangs?q={{{s}}}).</p>

            <p class="custom-paragraph"><strong>Bang Category</strong> (id="bang-category"): An optional category for
                the bang (e.g.,
                "General").</p>

            <p class="custom-paragraph"><strong>Description</strong> (id="bang-description"): An optional description of
                the bang (e.g.,
                "Search the
                bang
                shortcuts").</p>

            <p class="custom-paragraph"><strong>Keyword</strong> (id="bang-sc"): An optional keyword or shortcut for the
                bang (e.g.,
                "ChatGPT").</p>`

        const toggle_explanation = () => {
            element = document.getElementById("explain");
            button = document.getElementById("toggle");
            if (element.innerHTML !== explain) {
                element.innerHTML = explain;
                button.innerHTML = "Show less";
            } else {
                element.innerHTML = "";
                button.innerHTML = "Show full explanation";
            }
        }
    </script>
</body>

</html>